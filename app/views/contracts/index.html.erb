<%- model_class = Contract -%>
<div class="index-content">
<div class="index-title">
  <h1>
    <%=t '.title', :default => model_class.model_name.human.pluralize.titleize %>
  </h1>
  
</div>

<div class='row' style="background-color:#EEEEEC; margin-bottom:20px;">
  <div class="col-md-2" style="margin-top:10px;">
    <h3>搜索条件：</h3>
  </div>

  <div class="col-md-4" style="margin-top:28px;">
    <%= form_tag contracts_path, :method => 'get' do %>
      <div class="col-md-8" style="padding:2px">
          <%= text_field_tag :search, params[:search], :class=>"form-control" %>
      </div>
      <div class="col-md-4" style="padding:2px;">
        <%= submit_tag "Search", :title => nil, :class=>"btn btn-primary form-control" %>
          
      </div>
    <% end %>
  </div>

    <div class="col-md-2 form-group" style="margin-top:30px;">
      <div class="dropdown">
        <button class="btn btn-default dropdown-toggle form-control" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
              选择月份
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
          <li><a href="#">1月</a></li>
          <li><a href="#">2月</a></li>
          <li><a href="#">3月</a></li>
          <li><a href="#">4月</a></li>
          <li><a href="#">5月</a></li>
          <li><a href="#">6月</a></li>
          <li><a href="#">7月</a></li>
          <li><a href="#">8月</a></li>
          <li><a href="/contracts?utf8=✓&search=09&commit=Search">9月</a></li>
          <li><a href="/contracts?utf8=✓&search=10&commit=Search">10月</a></li>
          <li><a href="/contracts?utf8=✓&search=11&commit=Search">11月</a></li>
          <li><a href="/contracts?utf8=✓&search=12&commit=Search">12月</a></li>
        </ul>
      </div>
      
    </div>

    <div class="col-md-2 form-group" style="margin-top:30px;">
      <div class="dropdown">
        <button class="btn btn-default dropdown-toggle form-control" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
              生成报表
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
          <li><a href="/contracts.pdf">PDF</a></li>
          <li><a href="/contracts.csv">CSV</a></li>
          <li><a href="/contracts.xls">Excel</a></li>
        </ul>
      </div>
      
    </div>

    <div class="col-md-2 form-group" style="margin-top:30px;">
      <div class="dropdown">
        <button class="btn btn-default dropdown-toggle form-control" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
              排列方式
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
          <li><a href="合同名称">合同名称</a></li>
          <li><a href="客户公司">客户公司</a></li>
          <li><a href="合同金额">合同金额</a></li>
          <li><a href="签约日期">签约日期</a></li>
        </ul>
      </div>
      
    </div>

</div>


<div>
  <table class="table table-striped table-hover", style="font-size: 15px; font-family:Arial;margin:0px auto;">
  <thead>
    <tr>
      <th><%= sortable "合同标题" %></th>
      <th><%= sortable "客户公司" %></th>
      <th><%= sortable "sign_date", "签约日期" %></th>
      <th><%= sortable "订单成本" %></th>
      <th><%= sortable "amount", "合同金额" %></th>
      <th>项目利润</th>
      <th>发票状态</th>
    </tr>
  </thead>
  <tbody>
    <% @contracts.each do |contract| %>
      <tr data-link="<%= contract_path(contract) %>">
        <td><%= contract.title %></td>
        <td><%= @clients.find(contract.client_id).name %></td>
        <% @contract_amount = 0 %>
        <td><%= contract.sign_date %></td>
        <% contract.orders.each do |order| %>
          <% @contract_amount += order.unit_price*order.unit_count %>
        <% end %>
        <td><%= @contract_amount %></td>
        <td><%= contract.amount %></td>
        <td><%= contract.amount-(contract.cost||0)-@contract_amount %></td>
        <% if !contract.invoices.first.nil? %>
          <td><%= contract.invoices.first.status %></td>
        <% else %>
          <td>未开票</td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
</div>

<div style="margin-bottom: 10px"></div>

<%= link_to t('.new', :default => t("helpers.links.new")),
            new_contract_path,
            :class => 'btn btn-primary' %>

</div>
